<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CCGate ç”¨é‡æŸ¥è¯¢</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f7;
            color: #1d1d1f;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #007aff;
            margin-bottom: 10px;
            font-size: 2.5em;
            font-weight: 600;
        }

        .auth-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #e5e5e7;
        }

        .auth-tab {
            flex: 1;
            padding: 12px 20px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            color: #666;
            transition: all 0.3s ease;
        }

        .auth-tab.active {
            color: #007aff;
            border-bottom: 2px solid #007aff;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e5e7;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #007aff;
        }

        .btn {
            padding: 12px 24px;
            background: #007aff;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .btn:hover {
            background: #0056b3;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
        }

        .alert-success {
            background: #d1edff;
            color: #0066cc;
            border: 1px solid #0066cc;
        }

        .alert-error {
            background: #ffe6e6;
            color: #d63384;
            border: 1px solid #d63384;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .card h3 {
            margin-bottom: 20px;
            color: #1d1d1f;
            font-size: 1.4em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e5e5e7;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #34c759, #ffcc02, #ff3b30);
            border-radius: 5px;
            transition: width 0.3s ease;
        }

        .usage-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: 700;
            color: #007aff;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            font-weight: 500;
        }

        .upstream-list {
            display: grid;
            gap: 15px;
        }

        .upstream-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .upstream-name {
            font-weight: 600;
            color: #1d1d1f;
        }

        .upstream-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .status-healthy {
            background: #d1f2eb;
            color: #00875a;
        }

        .status-unhealthy {
            background: #ffebe6;
            color: #de350b;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007aff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .model-usage {
            margin-top: 20px;
        }

        .model-item {
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .model-name {
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 10px;
        }

        .token-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            font-size: 0.9em;
        }

        .cost-info {
            margin-top: 10px;
            padding: 10px;
            background: #e8f4fd;
            border-radius: 6px;
            font-size: 0.9em;
            color: #0066cc;
        }

        .hidden {
            display: none !important;
        }

        /* ç§Ÿæˆ·åˆ—è¡¨æ ·å¼ */
        .tenant-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .tenant-item {
            border: 2px solid #e5e5e7;
            border-radius: 12px;
            padding: 20px;
            background: #fafafa;
        }

        .tenant-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e5e5e7;
        }

        .tenant-name {
            font-size: 1.2em;
            font-weight: 600;
            color: #007aff;
        }

        .tenant-id {
            font-size: 0.9em;
            color: #666;
            font-family: monospace;
        }

        .tenant-stats {
            margin-bottom: 15px;
        }

        .stat-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .tenant-models {
            margin-bottom: 15px;
        }

        .tenant-limits {
            border-top: 1px solid #e5e5e7;
            padding-top: 15px;
        }

        .limits-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .limit-item {
            margin-bottom: 10px;
        }

        .limit-model {
            font-weight: 600;
            color: #007aff;
            margin-bottom: 5px;
        }

        .limit-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            font-size: 0.9em;
            color: #666;
        }
    </style>
</head>
<body>
    <div id="app" class="container">
        <div class="header">
            <h1>ğŸš€ CCGate ç”¨é‡æŸ¥è¯¢</h1>
            <p>å®æ—¶æŸ¥çœ‹æ‚¨çš„APIä½¿ç”¨æƒ…å†µå’Œé™é¢çŠ¶æ€</p>
        </div>

        <!-- è®¤è¯åŒºåŸŸ -->
        <div class="auth-section">
            <div class="auth-tabs">
                <button class="auth-tab" :class="{ active: authMode === 'tenant' }" @click="setAuthMode('tenant')">
                    ç”¨æˆ·æŸ¥è¯¢
                </button>
                <button class="auth-tab" :class="{ active: authMode === 'admin' }" @click="setAuthMode('admin')">
                    ç®¡ç†å‘˜ç™»å½•
                </button>
            </div>

            <form @submit.prevent="authenticate" class="auth-form">
                <div v-if="authMode === 'tenant'" class="form-group">
                    <label>API Key</label>
                    <input type="text" v-model="tenantCredentials.apiKey" placeholder="è¯·è¾“å…¥æ‚¨çš„API Key" required>
                </div>
                
                <div v-if="authMode === 'admin'" class="form-group">
                    <label>ç”¨æˆ·å</label>
                    <input type="text" v-model="adminCredentials.username" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜ç”¨æˆ·å" required>
                </div>
                
                <div v-if="authMode === 'admin'" class="form-group">
                    <label>å¯†ç </label>
                    <input type="password" v-model="adminCredentials.password" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç " required>
                </div>
                
                <button type="submit" class="btn" :disabled="loading">
                    {{ loading ? 'æŸ¥è¯¢ä¸­...' : 'æŸ¥è¯¢ç”¨é‡' }}
                </button>
            </form>

            <div v-if="error" class="alert alert-error">
                {{ error }}
            </div>
        </div>

        <!-- åŠ è½½çŠ¶æ€ -->
        <div v-if="loading && !error" class="loading">
            <div class="loading-spinner"></div>
            <p>æ­£åœ¨åŠ è½½æ•°æ®...</p>
        </div>

        <!-- æ•°æ®å±•ç¤ºåŒºåŸŸ -->
        <div v-if="usageData && !loading" class="dashboard">
            <!-- ä»Šæ—¥é™é¢è¿›åº¦ -->
            <div class="card">
                <h3>ğŸ“Š ä»Šæ—¥é™é¢ä½¿ç”¨æƒ…å†µ</h3>
                <div v-if="usageData.limits">
                    <div v-if="usageData.limits.usd" class="progress-section">
                        <p><strong>æˆæœ¬é™é¢ï¼š</strong>${{ usageData.limits.usd.limit }}</p>
                        <div class="progress-bar">
                            <div class="progress-fill" :style="{ width: Math.min(usageData.limits.usd.percentage, 100) + '%' }"></div>
                        </div>
                        <p>å·²ä½¿ç”¨: ${{ usageData.limits.usd.used.toFixed(6) }} ({{ usageData.limits.usd.percentage }}%)</p>
                    </div>
                    <div v-else class="model-usage">
                        <div v-for="(modelLimits, model) in usageData.limits" :key="model" class="model-item">
                            <div class="model-name">{{ model }}</div>
                            <div class="token-stats">
                                <div>è¾“å…¥Token: {{ modelLimits.inputTokens.used }}/{{ modelLimits.inputTokens.limit }}</div>
                                <div>è¾“å‡ºToken: {{ modelLimits.outputTokens.used }}/{{ modelLimits.outputTokens.limit }}</div>
                                <div>ç¼“å­˜åˆ›å»º: {{ modelLimits.cacheCreationTokens.used }}/{{ modelLimits.cacheCreationTokens.limit }}</div>
                                <div>ç¼“å­˜è¯»å–: {{ modelLimits.cacheReadTokens.used }}/{{ modelLimits.cacheReadTokens.limit }}</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div v-else>
                    <p>æš‚æ— é™é¢é…ç½®</p>
                </div>
            </div>

            <!-- ä»Šæ—¥æ¶ˆè€—ç»Ÿè®¡ -->
            <div class="card">
                <h3>ğŸ“ˆ ä»Šæ—¥æ¶ˆè€—ç»Ÿè®¡</h3>
                <div class="usage-stats">
                    <div class="stat-item">
                        <div class="stat-value">{{ usageData.todayUsage.totalRequests || 0 }}</div>
                        <div class="stat-label">æ€»è¯·æ±‚æ•°</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">{{ formatNumber(usageData.todayUsage.totalTokens || 0) }}</div>
                        <div class="stat-label">æ€»Tokenæ•°</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${{ (usageData.todayUsage.totalCost || 0).toFixed(4) }}</div>
                        <div class="stat-label">æ€»æˆæœ¬</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">{{ usageData.todayUsage.errorRate || 0 }}%</div>
                        <div class="stat-label">é”™è¯¯ç‡</div>
                    </div>
                </div>

                <!-- æŒ‰æ¨¡å‹ç»Ÿè®¡ -->
                <div v-if="usageData.todayUsage.byModel" class="model-usage">
                    <h4>æŒ‰æ¨¡å‹ç»Ÿè®¡</h4>
                    <div v-for="(modelUsage, model) in usageData.todayUsage.byModel" :key="model" class="model-item">
                        <div class="model-name">{{ model }}</div>
                        <div class="token-stats">
                            <div>è¯·æ±‚æ•°: {{ modelUsage.totalRequests || 0 }}</div>
                            <div>æ€»Token: {{ formatNumber(modelUsage.totalTokens || 0) }}</div>
                            <div>è¾“å…¥: {{ formatNumber(modelUsage.inputTokens || 0) }}</div>
                            <div>è¾“å‡º: {{ formatNumber(modelUsage.outputTokens || 0) }}</div>
                            <div>ç¼“å­˜åˆ›å»º: {{ formatNumber(modelUsage.cacheCreationTokens || 0) }}</div>
                            <div>ç¼“å­˜è¯»å–: {{ formatNumber(modelUsage.cacheReadTokens || 0) }}</div>
                        </div>
                        <div class="cost-info">
                            æˆæœ¬: ${{ (modelUsage.totalCost || 0).toFixed(6) }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç®¡ç†å‘˜ä¸“ç”¨ï¼šç³»ç»Ÿæ€»è§ˆ -->
            <div v-if="authMode === 'admin' && systemStats" class="card">
                <h3>ğŸŒ ç³»ç»Ÿæ€»è§ˆ</h3>
                <div class="usage-stats">
                    <div class="stat-item">
                        <div class="stat-value">{{ systemStats.totalRequests || 0 }}</div>
                        <div class="stat-label">ç³»ç»Ÿæ€»è¯·æ±‚</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${{ (systemStats.totalCost || 0).toFixed(2) }}</div>
                        <div class="stat-label">ç³»ç»Ÿæ€»æˆæœ¬</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">{{ systemStats.activeTenants || 0 }}</div>
                        <div class="stat-label">æ´»è·ƒç§Ÿæˆ·</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">{{ systemStats.healthyUpstreams || 0 }}/{{ systemStats.totalUpstreams || 0 }}</div>
                        <div class="stat-label">å¥åº·ä¸Šæ¸¸</div>
                    </div>
                </div>
            </div>

            <!-- ç®¡ç†å‘˜ä¸“ç”¨ï¼šä¸Šæ¸¸çŠ¶æ€ -->
            <div v-if="authMode === 'admin' && upstreams" class="card">
                <h3>âš¡ ä¸Šæ¸¸æœåŠ¡çŠ¶æ€</h3>
                <div class="upstream-list">
                    <div v-for="upstream in upstreams.upstreams" :key="upstream.id" class="upstream-item">
                        <div>
                            <div class="upstream-name">{{ upstream.name }}</div>
                            <div style="font-size: 0.9em; color: #666;">{{ upstream.url }}</div>
                        </div>
                        <div class="upstream-status" :class="upstream.healthy ? 'status-healthy' : 'status-unhealthy'">
                            {{ upstream.healthy ? 'å¥åº·' : 'ä¸å¥åº·' }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç®¡ç†å‘˜ä¸“ç”¨ï¼šå„ç”¨æˆ·ä½¿ç”¨æƒ…å†µï¼ˆæ”¾åœ¨æœ€ä¸‹é¢ï¼‰ -->
        <div v-if="authMode === 'admin' && usageData && usageData.tenants" class="card" style="margin-top: 30px;">
            <h3>ğŸ‘¥ å„ç”¨æˆ·ä½¿ç”¨æƒ…å†µ</h3>
            <div class="tenant-list">
                <div v-for="tenant in usageData.tenants" :key="tenant.tenantId" class="tenant-item">
                    <div class="tenant-header">
                        <div class="tenant-name">{{ tenant.tenantName || tenant.tenantId }}</div>
                        <div class="tenant-id">ID: {{ tenant.tenantId }}</div>
                    </div>
                    
                    <div class="tenant-stats">
                        <div class="stat-row">
                            <div class="stat-item">
                                <div class="stat-value">{{ tenant.usage.totalRequests || 0 }}</div>
                                <div class="stat-label">è¯·æ±‚æ•°</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ formatNumber(tenant.usage.totalTokens || 0) }}</div>
                                <div class="stat-label">æ€»Token</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${{ (tenant.usage.totalCost || 0).toFixed(4) }}</div>
                                <div class="stat-label">æˆæœ¬</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ tenant.usage.errorRate || 0 }}%</div>
                                <div class="stat-label">é”™è¯¯ç‡</div>
                            </div>
                        </div>
                    </div>

                    <!-- æŒ‰æ¨¡å‹ä½¿ç”¨æƒ…å†µ -->
                    <div v-if="tenant.usage.byModel" class="tenant-models">
                        <div v-for="(modelUsage, model) in tenant.usage.byModel" :key="model" class="model-item">
                            <div class="model-name">{{ model }}</div>
                            <div class="token-stats">
                                <div>è¯·æ±‚æ•°: {{ modelUsage.totalRequests || 0 }}</div>
                                <div>æ€»Token: {{ formatNumber(modelUsage.totalTokens || 0) }}</div>
                                <div>è¾“å…¥: {{ formatNumber(modelUsage.inputTokens || 0) }}</div>
                                <div>è¾“å‡º: {{ formatNumber(modelUsage.outputTokens || 0) }}</div>
                                <div>ç¼“å­˜åˆ›å»º: {{ formatNumber(modelUsage.cacheCreationTokens || 0) }}</div>
                                <div>ç¼“å­˜è¯»å–: {{ formatNumber(modelUsage.cacheReadTokens || 0) }}</div>
                            </div>
                            <div class="cost-info">
                                æˆæœ¬: ${{ (modelUsage.totalCost || 0).toFixed(6) }}
                            </div>
                        </div>
                    </div>

                    <!-- é™é¢çŠ¶æ€ -->
                    <div v-if="tenant.limits" class="tenant-limits">
                        <div class="limits-title">é™é¢çŠ¶æ€</div>
                        <div v-if="tenant.limits.usd" class="limit-item">
                            <span>æˆæœ¬é™é¢: ${{ tenant.limits.usd.used.toFixed(6) }} / ${{ tenant.limits.usd.limit }} ({{ tenant.limits.usd.percentage }}%)</span>
                            <div class="progress-bar">
                                <div class="progress-fill" :style="{ width: Math.min(tenant.limits.usd.percentage, 100) + '%' }"></div>
                            </div>
                        </div>
                        <div v-else>
                            <div v-for="(modelLimits, model) in tenant.limits" :key="model" class="limit-item">
                                <div class="limit-model">{{ model }}</div>
                                <div class="limit-details">
                                    <div>è¾“å…¥: {{ modelLimits.inputTokens.used }}/{{ modelLimits.inputTokens.limit }}</div>
                                    <div>è¾“å‡º: {{ modelLimits.outputTokens.used }}/{{ modelLimits.outputTokens.limit }}</div>
                                    <div>ç¼“å­˜åˆ›å»º: {{ modelLimits.cacheCreationTokens.used }}/{{ modelLimits.cacheCreationTokens.limit }}</div>
                                    <div>ç¼“å­˜è¯»å–: {{ modelLimits.cacheReadTokens.used }}/{{ modelLimits.cacheReadTokens.limit }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    authMode: 'tenant',
                    adminCredentials: {
                        username: '',
                        password: ''
                    },
                    tenantCredentials: {
                        apiKey: ''
                    },
                    loading: false,
                    error: '',
                    usageData: null,
                    systemStats: null,
                    upstreams: null
                }
            },
            mounted() {
                // é¡µé¢åŠ è½½æ—¶å°è¯•è¯»å–æœ€åä½¿ç”¨çš„API Key
                this.loadLastApiKey();
            },
            methods: {
                // åŠ è½½æœ€åä½¿ç”¨çš„API Key
                loadLastApiKey() {
                    try {
                        const savedKey = localStorage.getItem('ccgate_last_api_key');
                        if (savedKey) {
                            // ä»base64è§£ç 
                            this.tenantCredentials.apiKey = atob(savedKey);
                            // å¦‚æœæœ‰ä¿å­˜çš„keyï¼Œè‡ªåŠ¨æ‰§è¡ŒæŸ¥è¯¢
                            if (this.tenantCredentials.apiKey && this.authMode === 'tenant') {
                                this.authenticate();
                            }
                        }
                    } catch (error) {
                        console.warn('è¯»å–ä¿å­˜çš„API Keyå¤±è´¥:', error);
                    }
                },

                // ä¿å­˜API Keyåˆ°æœ¬åœ°å­˜å‚¨
                saveLastApiKey(apiKey) {
                    try {
                        // ä½¿ç”¨base64ç¼–ç ä¿å­˜
                        localStorage.setItem('ccgate_last_api_key', btoa(apiKey));
                    } catch (error) {
                        console.warn('ä¿å­˜API Keyå¤±è´¥:', error);
                    }
                },

                setAuthMode(mode) {
                    this.authMode = mode;
                    this.error = '';
                    this.usageData = null;
                    this.systemStats = null;
                    this.upstreams = null;
                },

                async authenticate() {
                    this.loading = true;
                    this.error = '';

                    try {
                        if (this.authMode === 'admin') {
                            await this.adminLogin();
                        } else {
                            await this.tenantQuery();
                        }
                    } catch (error) {
                        this.error = error.message;
                        this.usageData = null;
                        this.systemStats = null;
                        this.upstreams = null;
                    } finally {
                        this.loading = false;
                    }
                },

                async adminLogin() {
                    // ç®¡ç†å‘˜è®¤è¯ - ä½¿ç”¨POSTæ–¹å¼
                    const response = await this.apiRequest('/usage', {
                        method: 'POST',
                        body: JSON.stringify({
                            type: 'admin',
                            username: this.adminCredentials.username,
                            password: this.adminCredentials.password
                        })
                    });

                    this.usageData = response.data.usage;
                    this.systemStats = response.data.system;
                    this.upstreams = response.data.upstreams;
                },

                async tenantQuery() {
                    // ç§Ÿæˆ·æŸ¥è¯¢ - ä½¿ç”¨POSTæ–¹å¼
                    const response = await this.apiRequest('/usage', {
                        method: 'POST',
                        body: JSON.stringify({
                            type: 'tenant',
                            apiKey: this.tenantCredentials.apiKey
                        })
                    });

                    this.usageData = response.data.usage;
                    
                    // æŸ¥è¯¢æˆåŠŸåä¿å­˜API Key
                    this.saveLastApiKey(this.tenantCredentials.apiKey);
                },

                async apiRequest(url, options = {}) {
                    const fetchOptions = {
                        credentials: 'include',
                        headers: {
                            'Content-Type': 'application/json',
                            ...(options.headers || {})
                        },
                        ...options
                    };
                    
                    const response = await fetch(url, fetchOptions);

                    if (!response.ok) {
                        if (response.status === 401) {
                            throw new Error('è®¤è¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥è´¦å·å¯†ç æˆ–API Key');
                        } else if (response.status === 404) {
                            throw new Error('è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨');
                        } else {
                            const errorData = await response.json().catch(() => ({}));
                            throw new Error(errorData.error || `è¯·æ±‚å¤±è´¥ (${response.status})`);
                        }
                    }

                    return await response.json();
                },

                formatNumber(num) {
                    if (num >= 1000000) {
                        return (num / 1000000).toFixed(1) + 'M';
                    } else if (num >= 1000) {
                        return (num / 1000).toFixed(1) + 'K';
                    }
                    return num.toString();
                }
            }
        }).mount('#app');
    </script>
</body>
</html>